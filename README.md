# TwitterClone

A Rust-based backend for a Twitter-like social network, featuring user authentication, tweets, media uploads to AWS S3, likes, follows, and more. Built with Actix-web, Diesel, PostgreSQL, and AWS S3.

---

## Features

- **User registration & authentication** (JWT-based)
- **User profiles** (with bio, avatar, etc.)
- **Tweets** (create, list, delete, reply, retweet)
- **Likes & follows**
- **Media uploads** (images/videos) to AWS S3
- **Media metadata** stored in PostgreSQL
- **Secure password hashing** (Argon2)
- **Async/await** for all I/O operations

---

## Project Structure

```
src/
  handlers/        // HTTP endpoint logic (auth, tweets, users, media, etc.)
  models/          // Diesel ORM models
  repositories/    // Database access logic
  requests/        // Request/response DTOs
  storage/         // AWS S3 integration
  database.rs      // DB pool setup
  jwt.rs           // JWT auth logic
  main.rs          // App entry point and routing
  schema.rs        // Diesel schema (autogenerated)
```

---

## Getting Started

### Prerequisites

- Rust (latest stable)
- PostgreSQL
- AWS S3 bucket (for media)
- [Diesel CLI](https://diesel.rs/guides/getting-started/)

### Environment Variables

Create a `.env` file in the project root with:

```
DATABASE_URL=postgres://user:password@localhost/twitterclone
JWT_SECRET=your_jwt_secret
AWS_REGION=your-aws-region
AWS_BUCKET_NAME=your-s3-bucket
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
```

### Database Setup

1. Run migrations:
   ```sh
   diesel migration run
   ```

2. (Optional) Seed the database as needed.

### Running the Server

```sh
cargo run
```

The server will start at `http://127.0.0.1:8080`.

---

## API Endpoints

### Auth

- `POST   /auth/register`   — Register a new user
- `POST   /auth/login`      — Login and get JWT
- `POST   /auth/protected`  — Example protected endpoint (JWT required)
- `GET    /auth/me`         — Get current user info (JWT required)

### Users

- `GET    /users/`                  — List all users
- `GET    /users/{id}`              — Get user by ID
- `PATCH  /users/{id}`              — Update user by ID
- `DELETE /users/{id}`              — Delete user by ID
- `GET    /users/{id}/followers`    — Get followers of a user
- `GET    /users/{id}/following`    — Get users followed by a user

### Follows

- `POST   /follows/{id}`    — Follow a user by ID
- `DELETE /follows/{id}`    — Unfollow a user by ID
- `GET    /follows/{id}`    — Check if current user follows user by ID

### Tweets

- `POST   /tweets/`                 — Create a new tweet
- `GET    /tweets/`                 — List all tweets
- `GET    /tweets/{id}`             — Get tweet by ID
- `DELETE /tweets/`                 — Delete a tweet (by ID in body or param)
- `POST   /tweets/{id}/reply`       — Reply to a tweet
- `GET    /tweets/{id}/replies`     — Get replies to a tweet
- `POST   /tweets/{id}/retweet`     — Retweet a tweet
- `POST   /tweets/{id}/like`        — Like a tweet
- `DELETE /tweets/{id}/like`        — Remove like from a tweet
- `GET    /tweets/{id}/likes`       — Get likes for a tweet

### Media

- `POST   /media/upload`    — Upload image/video (requires JWT, only images/videos allowed, stored on S3)

---

## Media Upload

- Only authenticated users can upload.
- Only images (`.png`, `.jpg`, `.jpeg`, `.gif`) and videos (`.mp4`, `.mov`, `.webm`) are allowed.
- Files are stored on AWS S3, and metadata is saved in the `media` table.
- When a tweet is deleted, all associated media records and S3 files are also deleted.

---

## Development

- All database access is via Diesel.
- All async I/O uses async/await.
- Passwords are hashed with Argon2.
- JWT is used for authentication (see `src/jwt.rs`).

---

**Note:**  
This project is a backend only. You can use tools like Postman or a frontend app to interact with the API.